---
phase: 01-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - pyproject.toml
  - src/astraea/__init__.py
  - src/astraea/models/__init__.py
  - src/astraea/models/metadata.py
  - src/astraea/models/profiling.py
  - src/astraea/models/sdtm.py
  - src/astraea/models/controlled_terms.py
  - tests/__init__.py
  - tests/test_models/__init__.py
  - tests/test_models/test_metadata.py
autonomous: true

must_haves:
  truths:
    - "Project installs cleanly with all dependencies via pip install -e ."
    - "All Pydantic models validate correct data and reject invalid data"
    - "pytest discovers and runs model tests successfully"
  artifacts:
    - path: "pyproject.toml"
      provides: "Project configuration with all dependencies"
      contains: "pyreadstat"
    - path: "src/astraea/models/metadata.py"
      provides: "VariableMetadata, DatasetMetadata models"
      exports: ["VariableMetadata", "DatasetMetadata"]
    - path: "src/astraea/models/profiling.py"
      provides: "ValueDistribution, VariableProfile, DatasetProfile models"
      exports: ["DatasetProfile", "VariableProfile", "ValueDistribution"]
    - path: "src/astraea/models/sdtm.py"
      provides: "DomainSpec, VariableSpec, DomainClass models"
      exports: ["DomainSpec", "VariableSpec", "DomainClass"]
    - path: "src/astraea/models/controlled_terms.py"
      provides: "Codelist, CodelistTerm, CTPackage models"
      exports: ["Codelist", "CodelistTerm", "CTPackage"]
  key_links:
    - from: "pyproject.toml"
      to: "src/astraea/"
      via: "package configuration"
      pattern: "packages.*astraea"
---

<objective>
Set up the Python project structure and define all Pydantic data models that downstream plans depend on.

Purpose: Every subsequent plan imports these models. This is the type foundation for the entire system.
Output: Installable Python package with validated data models and passing tests.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create project structure and pyproject.toml</name>
  <files>
    pyproject.toml
    src/astraea/__init__.py
    src/astraea/cli/__init__.py
    src/astraea/io/__init__.py
    src/astraea/profiling/__init__.py
    src/astraea/reference/__init__.py
    src/astraea/transforms/__init__.py
    src/astraea/models/__init__.py
    src/astraea/data/sdtm_ig/.gitkeep
    src/astraea/data/ct/.gitkeep
    tests/__init__.py
    tests/test_models/__init__.py
    tests/test_io/__init__.py
    tests/test_profiling/__init__.py
    tests/test_reference/__init__.py
    tests/test_transforms/__init__.py
  </files>
  <action>
    Create the full project directory structure per the research architecture.

    pyproject.toml should use setuptools with:
    - name: "astraea-sdtm"
    - python_requires: ">=3.11"
    - Dependencies: pyreadstat>=1.3.3, pandas>=2.2, pydantic>=2.10, typer>=0.15, rich>=13.9, loguru>=0.7, python-dotenv>=1.0, openpyxl>=3.1
    - Dev dependencies (optional): pytest>=8.0, pytest-cov
    - Entry point: astraea = "astraea.cli.app:app"
    - Package discovery: src layout

    src/astraea/__init__.py should define __version__ = "0.1.0".

    All other __init__.py files should be empty (or have brief module docstrings).

    After creating files, run: pip install -e ".[dev]"
  </action>
  <verify>
    Run: pip install -e ".[dev]" && python -c "import astraea; print(astraea.__version__)" && pytest --collect-only
  </verify>
  <done>Package installs without errors, astraea imports successfully, pytest discovers test directories.</done>
</task>

<task type="auto">
  <name>Task 2: Define all Pydantic data models</name>
  <files>
    src/astraea/models/metadata.py
    src/astraea/models/profiling.py
    src/astraea/models/sdtm.py
    src/astraea/models/controlled_terms.py
    src/astraea/models/__init__.py
    tests/test_models/test_metadata.py
  </files>
  <action>
    Create Pydantic v2 models for all data structures used in Phase 1.

    **metadata.py** -- SAS file metadata:
    - VariableMetadata: name (str), label (str), sas_format (str | None), dtype (Literal["numeric", "character"]), storage_width (int | None)
    - DatasetMetadata: filename (str), row_count (int), col_count (int), variables (list[VariableMetadata]), file_encoding (str | None)

    **profiling.py** -- Dataset profiling results:
    - ValueDistribution: value (str), count (int), percentage (float)
    - VariableProfile: name (str), label (str), dtype (str), sas_format (str | None), n_total (int), n_missing (int), n_unique (int), missing_pct (float), sample_values (list[str]), top_values (list[ValueDistribution]), is_date (bool), detected_date_format (str | None), is_edc_column (bool, default=False)
    - DatasetProfile: filename (str), row_count (int), col_count (int), variables (list[VariableProfile]), date_variables (list[str]), edc_columns (list[str])

    **sdtm.py** -- SDTM-IG reference data:
    - DomainClass: Enum with INTERVENTIONS, EVENTS, FINDINGS, SPECIAL_PURPOSE, TRIAL_DESIGN, RELATIONSHIP, ASSOCIATED_PERSONS
    - CoreDesignation: Enum with REQ, EXP, PERM
    - VariableSpec: name (str), label (str), data_type (Literal["Char", "Num"]), core (CoreDesignation), cdisc_notes (str), codelist_code (str | None), order (int)
    - DomainSpec: domain (str), description (str), domain_class (DomainClass), structure (str), variables (list[VariableSpec])
    - SDTMIGPackage: version (str), domains (dict[str, DomainSpec])

    **controlled_terms.py** -- NCI Controlled Terminology:
    - CodelistTerm: submission_value (str), synonyms (list[str]), definition (str), nci_preferred_term (str)
    - Codelist: code (str), name (str), extensible (bool), variable_mappings (list[str]), terms (dict[str, CodelistTerm])
    - CTPackage: version (str), ig_version (str), codelists (dict[str, Codelist])

    **models/__init__.py** -- Re-export all models for convenient imports.

    **test_metadata.py** -- Write tests that:
    - Create a VariableMetadata with valid data, assert fields
    - Create a DatasetMetadata with a list of variables, assert serialization
    - Test validation rejects negative row_count (use Field(ge=0) in model)
    - Test model_dump() produces clean dict output

    Use Pydantic v2 syntax (model_dump, model_validate, Field with ge/le constraints where appropriate).
  </action>
  <verify>Run: pytest tests/test_models/ -v</verify>
  <done>All 4 model files exist with complete Pydantic models. Tests pass confirming validation works correctly.</done>
</task>

</tasks>

<verification>
- `pip install -e ".[dev]"` succeeds
- `python -c "from astraea.models import VariableMetadata, DatasetProfile, DomainSpec, Codelist; print('All models imported')"` succeeds
- `pytest tests/test_models/ -v` passes all tests
</verification>

<success_criteria>
- Installable Python package with all dependencies resolved
- All Pydantic models defined with proper types and validation
- Models importable from astraea.models namespace
- At least one test file with passing tests
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-01-SUMMARY.md`
</output>
