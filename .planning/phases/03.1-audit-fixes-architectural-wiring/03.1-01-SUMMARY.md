---
phase: 03.1-audit-fixes-architectural-wiring
plan: 01
subsystem: reference-data
tags: [ct-codelists, controlled-terminology, nci-evs, sdtm-ig]
dependency-graph:
  requires: [02.1]
  provides: [16-new-codelists, c66742-fix]
  affects: [03.1-03, 03.1-04, 04]
tech-stack:
  added: []
  patterns: []
key-files:
  created: []
  modified:
    - src/astraea/data/ct/codelists.json
    - tests/test_reference/test_controlled_terms.py
decisions:
  - id: D-03.1-01-01
    description: "Large extensible codelists (C65047, C67154) include ~43 common terms each, not all hundreds"
  - id: D-03.1-01-02
    description: "C78736 includes HIGH HIGH and LOW LOW terms (clinically significant range indicators per NCI EVS)"
  - id: D-03.1-01-03
    description: "Old test assertions for C66767/C66728/C66726/C66734 non-existence updated -- these are now valid codelists"
metrics:
  duration: ~3 min
  completed: 2026-02-27
---

# Phase 3.1 Plan 01: Add Missing CT Codelists Summary

Added 16 missing CT codelists to codelists.json and fixed C66742 invalid U term.

## One-liner

16 CT codelists added (5 non-extensible with complete term sets, 11 extensible) plus C66742 U term removal for correct AESER/AESDTH validation.

## What Changed

### Task 1: Fix C66742 and add 16 missing codelists
- Removed invalid "U" term from C66742 (No Yes Response) -- only N and Y are valid per NCI EVS
- Added 5 non-extensible codelists with COMPLETE term sets:
  - C66767 (Action Taken with Study Treatment) -- 7 terms
  - C66734 (Domain Abbreviation) -- 25 terms
  - C78736 (Reference Range Indicator) -- 6 terms (NORMAL, HIGH, LOW, ABNORMAL, HIGH HIGH, LOW LOW)
  - C71148 (Position) -- 3 terms
  - C66728 (Relation to Reference Period) -- 5 terms
- Added 11 extensible codelists with common terms:
  - C66727 (Disposition Event) -- 10 terms
  - C65047 (Laboratory Test Code) -- 43 terms
  - C67154 (Laboratory Test Name) -- 43 terms
  - C66741 (Vital Signs Test Code) -- 10 terms
  - C67153 (Vital Signs Test Name) -- 10 terms
  - C71153 (ECG Test Code) -- 9 terms
  - C71152 (ECG Test Name) -- 9 terms
  - C66726 (Pharmaceutical Dosage Form) -- 14 terms
  - C78734 (Specimen Type) -- 6 terms
  - C99079 (Epoch) -- 5 terms
  - C74456 (Anatomical Location) -- 9 terms

### Task 2: Tests for new codelists and C66742 fix
- Added TestC66742Fix class (5 tests): verify U removed, only N/Y, non-extensible, rejects U
- Added TestNonExtensibleCodelists class (5 tests): verify exact complete term sets
- Added TestExtensibleCodelists class (11 parametrized tests): verify loading, extensibility, minimum term counts
- Added TestAllSixteenCodelists class (2 tests): all 16 loadable, total count = 27
- Updated test_old_wrong_codes_do_not_exist: C66767, C66728, C66726, C66734 are now valid codelists

## Commits

| Hash | Message |
|------|---------|
| 84bcaea | fix(03.1-01): add 16 missing CT codelists and remove invalid C66742 U term |
| 9d9e1c9 | test(03.1-01): add tests for 16 new codelists and C66742 fix |

## Deviations from Plan

### Auto-fixed Issues

**1. [Rule 1 - Bug] Updated test_old_wrong_codes_do_not_exist**
- **Found during:** Task 2
- **Issue:** Existing test asserted C66767, C66728, C66726, C66734 do NOT exist (they were old wrong C-codes). But these are now valid codelists we just added.
- **Fix:** Updated test to only check C66770 (the only truly invalid old code). Added comment explaining the change.
- **Files modified:** tests/test_reference/test_controlled_terms.py

## Test Results

- Full suite: 663 passed, 15 skipped
- CT-specific: 61 tests in test_controlled_terms.py (all passing)
- Codelist count: 27 (11 original + 16 new)

## Next Phase Readiness

All 16 codelists now available for:
- Plan 03.1-03: Mapping engine validation can now validate CT compliance for all variable-codelist pairs
- Plan 03.1-04: VariableMapping enrichment has codelist data for all referenced codelists
- Phase 4: Human review gate can display CT validation results
